DROP DATABASE BIBLIOTECA;

CREATE DATABASE BIBLIOTECA;

USE BIBLIOTECA;

CREATE TABLE AUTOR(
	IDAUTOR INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE AUTORIA(
	IDAUTORIA INT PRIMARY KEY AUTO_INCREMENT,
	ID_LIVRO INT NOT NULL,
	ID_AUTOR INT NOT NULL
);

CREATE TABLE LIVRO(
	IDLIVRO INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(100) NOT NULL UNIQUE,
	CAPA VARCHAR(200), /*PATH PARA IMG*/
	QUANTIDADE INT NOT NULL DEFAULT 1,
	LIDO ENUM('S','N') NOT NULL,
	POSSUO ENUM('S','N') NOT NULL,
	ID_EMPRESTIMO INT
);

CREATE TABLE EMPRESTADOR(
	IDEMPRESTIMO INT PRIMARY KEY AUTO_INCREMENT,
	DATA_EMPRESTIMO DATE NOT NULL,
	NOME VARCHAR(30) NOT NULL,
	DATA_DEVOLUCAO DATE

);

CREATE TABLE LIVRO_CATEGORIA(
	IDLIVCAT INT PRIMARY KEY AUTO_INCREMENT,
	ID_LIVRO INT NOT NULL,
	ID_CATEGORIA INT NOT NULL
);

CREATE TABLE CATEGORIA(
	IDCATEGORIA INT PRIMARY KEY AUTO_INCREMENT,
	CATEGORIA VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE LIVRO_LOJA(
	IDLIVLOJA INT PRIMARY KEY AUTO_INCREMENT,
	ID_LIVRO INT NOT NULL,
	ID_LOJA INT NOT NULL
);

CREATE TABLE LOJA(
	IDLOJA INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30) NOT NULL UNIQUE,
	PRECO FLOAT(10,2) NOT NULL
);


CREATE TABLE TIPO(
	IDTIPO INT PRIMARY KEY AUTO_INCREMENT,
	TIPO VARCHAR(10) UNIQUE
);

CREATE TABLE LIVRO_TIPO(
	IDLIVTIPO INT PRIMARY KEY AUTO_INCREMENT,
	ID_LIVRO INT NOT NULL,
	ID_TIPO INT NOT NULL
);

/* ---------- CONSTRAINTS ----------- */

/*AUTORIA*/
ALTER TABLE AUTORIA ADD CONSTRAINT FK_AUTORIA_AUTOR
FOREIGN KEY (ID_AUTOR) REFERENCES AUTOR(IDAUTOR)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE AUTORIA ADD CONSTRAINT FK_AUTORIA_LIVRO
FOREIGN KEY (ID_LIVRO) REFERENCES LIVRO(IDLIVRO)
ON DELETE CASCADE
ON UPDATE CASCADE;

/*LIVRO_LOJA*/
ALTER TABLE LIVRO_LOJA ADD CONSTRAINT FK_LIVROLOJA_LIVRO
FOREIGN KEY (ID_LIVRO) REFERENCES LIVRO(IDLIVRO)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE LIVRO_LOJA ADD CONSTRAINT FK_LIVROLOJA_LOJA
FOREIGN KEY (ID_LOJA) REFERENCES LOJA(IDLOJA)
ON DELETE CASCADE
ON UPDATE CASCADE;

/*LIVRO*/
ALTER TABLE LIVRO ADD CONSTRAINT FK_LIVRO_EMPRESTIMO
FOREIGN KEY (ID_EMPRESTIMO) REFERENCES EMPRESTADOR(IDEMPRESTIMO)
ON DELETE CASCADE
ON UPDATE CASCADE;

/*LIVRO_TIPO*/
ALTER TABLE LIVRO_TIPO ADD CONSTRAINT FK_LIVROTIPO_LIVRO
FOREIGN KEY (ID_LIVRO) REFERENCES LIVRO(IDLIVRO)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE LIVRO_TIPO ADD CONSTRAINT FK_LIVROTIPO_TIPO
FOREIGN KEY (ID_TIPO) REFERENCES TIPO(IDTIPO)
ON DELETE CASCADE
ON UPDATE CASCADE;

/*LIVRO_CATEGORIA*/
ALTER TABLE LIVRO_CATEGORIA ADD CONSTRAINT FK_LIVROCAT_LIVRO
FOREIGN KEY (ID_LIVRO) REFERENCES LIVRO(IDLIVRO)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE LIVRO_CATEGORIA ADD CONSTRAINT FK_LIVROCAT_CATEGORIA
FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA(IDCATEGORIA)
ON DELETE CASCADE
ON UPDATE CASCADE;
